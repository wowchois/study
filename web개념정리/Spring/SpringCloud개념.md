# Spring Cloud
: Spring Boot 기반으로 MSA구조에 맞춰진 라이브러리 집합.  

그 중 Netflix OSS(Open Source Softwae) 도 Spring Cloud에 포함되어 있다.   


## SpringCloud에 속해있는 Netflix OSS
- [Eureka](#eureka)
- [Zuul](#zuul)
- [Ribbon](#ribbon)
- [Hystrix](#hystrix)




* * *      



### eureka
: _디스커버리 서버_  
> 각 서비스들의 인스턴스(정보 = ip/port/host)를 관리하며, 서비스들이 동적으로 확장/축소 하게 하는 역할.    

인스턴스들의 상태를 체크해서 사용하는 인스턴스는 ip/port 정보를 gateway로 넘겨주고, 사용하지 않거나 응답이 없는 경우 인스턴스를 삭제한다. -> Auto-Scaling   

#### eureka 동작   
1. 인스턴스가 새로 생기면, 각 인스턴스는 eureka로 생성 정보(ip/port 등)를 전송한다.   
2. eureka는 인스턴스들로부터 받은 정보를 저장/관리 하고 일정한 간격으로 인스턴스로 ping을 보내 상태를 체크한다.  
3. 각 컨테이너에서 트래픽에 따라 인스턴스가 생성 되고 그 때마다 eureka에서 인스턴스들을 필요에 따라 축소시키는 역할을 담당한다.


### zuul
: _API Gateway_   
> API요청을 Gateway에서 받고 해당하는 컨테이너로 전달하는 Edge Server역할을 한다.  

API를 라우팅하는 역할로, 라우팅 전에 eureka에서 전달 대상 인스턴스 정보를 호출해서 라우팅 시킨다.   
gateway로 도메인을 통합해 관리한다.        
Gateway에서 데이터 통계, 로그관리 등 가능하다.    

API요청 정보가 잘못된 부분이 있는지 체크하는 필터(Filter)역할도 한다.      
요청정보(인증 정보, 요청 도메인 에러 등)가 잘못되면 라우팅하지 않고, Gateway에서 요청을 거부한다.    

#### zuul 동작
1. 외부 API 요청 
2. 요청정보 필터링 (잘못된 요청은 거부)
3. 해당 요청 API가 속한 컨테이너의 인스턴스 정보를 얻기 위해 eureka에 정보 요청
4. eureka로 부터 받은 인스턴스 정보로 해당 인스턴스로 라우팅.


### ribbon
: _로드 밸런서_   
> MSA 내부에서의 부하분산을 담당 (내부 컨테이너끼리 통신할 때 부하를 분산한다.)  

인스턴스마다 ribbon이 존재하며, 인스턴스끼리 호출에 응답이 늦어지면 다른 인스턴스로 ribbon이 로드밸런싱한다.       


웹 서버 컨테이너에서 DB서버 컨테이너를 호출 할 경우, 각 컨테이너마다 수평적으로 인스턴스들이 여러개 생성되어 있다.      
웹 서버-인스턴스1 => DB서버-인스턴스1 을 호출 하는데, DB서버-인스턴스1이 요청이 늦어지면 DB서버-인스턴스2 로 웹 서버-인스턴스1의 ribbon이 부하분산을 시켜준다.       

```
1.   
웹 서버 컨테이너         =>     DB서버 컨테이너     
인스턴스 1 - ribbon     ->     인스턴스 1 - ribbon (요청 받았지만 늦어짐)    
인스턴스 2 - ribbon            인스턴스 2 - ribbon     
...                           ...              

2. 
웹 서버 컨테이너         =>     DB서버 컨테이너      
인스턴스 1 - ribbon     -/>     인스턴스 1 - ribbon (연결 해제)       
인스턴스 1 - ribbon      ->     인스턴스 2 - ribbon (2로 요청받음)     
...                            ...
```

### hystrix
: _서킷 브레이커_  
> MSA 구조에서 장애가 발생해도 전체적으로 장애가 전파되지 않도록 하는 역할. (장애 전파 차단)    

#### hystrix 동작
1. 현재 발생한 에러를 파악하고 서비스 이상을 감지하면 통신을 중단한다.   
2. 서비스를 격리 시키고 호출 수를 제한시키고, 격리된 서비스에서 밀려있는 스레드를 처리하게 한다.
3. 격리된 서비스가 정상으로 돌아오면 격리해제하고 다시 통신을 연결한다.   


__Fallback__ : 장애 발생 이후 처리될 수 있는 기능을 정의하고 수행. (예외처리)    




